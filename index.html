<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Company Dashboards</title>
<style>
  /* --------- Design tokens --------- */
  :root{
    color-scheme: light dark;

    --radius: 12px;
    --gap: 8px;
    --ring: 2px;
    --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;

    /* Light */
    --bg: #f7f7fb;
    --panel: #ffffff;
    --text: #1f2328;
    --muted: #6b7280;
    --muted-2: #9aa1ab;
    --line: #e7e7ef;
    --hover: #f4f5f8;
    --btn: #f6f7fa;
    --btn-border: #e2e5ea;
    --accent: #2563eb;
    --accent-soft: rgba(37, 99, 235, .08);
    --hit: rgba(37,99,235,.12);
    --shadow: 0 1px 2px rgba(0,0,0,.06), 0 8px 24px rgba(0,0,0,.06);

    /* Icons */
    --icon: #3f4b5f;
    --icon-muted: #6b7280;
  }
  @media (prefers-color-scheme: dark){
    :root{
      --bg: #0b0d12;
      --panel: #0f131a;
      --text: #e5e7eb;
      --muted: #9aa3ad;
      --muted-2: #7e8896;
      --line: #1e2430;
      --hover: #151b24;
      --btn: #10151d;
      --btn-border: #1e2633;
      --accent: #60a5fa;
      --accent-soft: rgba(96,165,250,.12);
      --hit: rgba(96,165,250,.18);
      --shadow: 0 1px 2px rgba(0,0,0,.35), 0 8px 24px rgba(0,0,0,.35);

      --icon: #d8dee9;
      --icon-muted: #aeb6c2;
    }
  }

  /* --------- Global --------- */
  html,body{ height:100%; }
  body{
    margin:0;
    padding: 24px;
    background: radial-gradient(1200px 500px at 10% -10%, var(--accent-soft), transparent 40%) no-repeat, var(--bg);
    color: var(--text);
    font-family: var(--font);
    -webkit-font-smoothing: antialiased;
    line-height: 1.35;
  }
  .app{ max-width: 1100px; margin: 0 auto; }

  .panel{
    background: var(--panel);
    border: 1px solid var(--line);
    border-radius: 16px;
    box-shadow: var(--shadow);
    overflow: clip;
  }

  /* --------- Header / Controls --------- */
  header{
    position: sticky; top: 0; z-index: 10;
    backdrop-filter: saturate(140%) blur(6px);
    background: color-mix(in hsl, var(--bg), transparent 40%);
    padding: 6px 0 14px;
  }
  .toolbar{ display:flex; flex-wrap:wrap; align-items:center; gap: 10px; }
  .title{ font-weight: 700; font-size: 18px; margin-right: auto; letter-spacing: .2px; }

  input[type="search"]{
    appearance: none; padding: 10px 12px; border-radius: 999px;
    border: 1px solid var(--btn-border); background: var(--panel); min-width: 280px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.06); color: var(--text);
  }
  input[type="search"]::placeholder{ color: var(--muted-2); }
  input[type="search"]:focus-visible{
    outline: none; box-shadow: 0 0 0 var(--ring) var(--accent-soft);
    border-color: color-mix(in srgb, var(--accent) 40%, var(--btn-border));
  }

  .btn{
    padding: 9px 12px; border-radius: 10px; border: 1px solid var(--btn-border);
    background: var(--btn); color: var(--text); cursor: pointer; line-height: 1;
    display:inline-flex; align-items:center; gap:8px;
    transition: background .15s ease, transform .04s ease;
  }
  .btn:hover{ background: var(--hover); }
  .btn:active{ transform: translateY(1px); }
  .btn:focus-visible{ outline: none; box-shadow: 0 0 0 var(--ring) var(--accent-soft); }

  .count{
    color: var(--muted); font-size: 12px; padding: 4px 8px; border-radius: 999px;
    border: 1px solid var(--line); background: linear-gradient(to bottom, transparent, rgba(0,0,0,.02));
  }

  /* --------- Tabs --------- */
  .tabs{ margin-top: 12px; }
  .tablist{
    display:flex; gap:8px; padding:8px; border-bottom:1px solid var(--line); background: var(--panel);
  }
  .tab{
    appearance:none; border:1px solid var(--btn-border); background: var(--btn);
    padding:8px 12px; border-radius: 999px; cursor:pointer; color: var(--text);
  }
  .tab[aria-selected="true"]{
    background: color-mix(in srgb, var(--accent) 8%, var(--btn));
    border-color: color-mix(in srgb, var(--accent) 35%, var(--btn-border));
    box-shadow: 0 0 0 var(--ring) var(--accent-soft);
  }
  .tabpanel{ display:none; }
  .tabpanel.active{ display:block; }

  /* --------- Tree --------- */
  .tree{ list-style: none; padding: 6px 8px 16px; margin: 0; }
  .node{ margin: 4px 0; }
  .row{
    display:flex; align-items:center; gap: 8px; padding: 6px 8px; border-radius: 10px;
    transition: background .12s ease, outline-color .12s ease;
  }
  .row:hover{ background: var(--hover); }
  .row.hit{ background: var(--hit); }

  .toggle{
    width: 1.6em; height: 1.6em; display: inline-grid; place-items:center;
    border: 1px solid var(--btn-border); border-radius: 8px; background: var(--panel);
    cursor: pointer; line-height: 1; color: var(--icon); font-size: 1rem; font-weight: 900;
  }
  .toggle:hover{ background: var(--hover); }
  .toggle.leaf { visibility: hidden; }

  .label{
    display:inline-flex; align-items:center; gap:8px; text-decoration: none;
    color: var(--text); font-size: 14px; font-weight: 500;
  }
  .label:hover{ text-decoration: underline; text-underline-offset: 3px; }
  .label[target="_blank"]::after{
    content: "↗"; font-size: 12px; color: var(--icon-muted); margin-left: 2px;
  }

  .badge{
    margin-left: 4px; font-size: 11px; color: var(--muted); padding: 2px 6px; border-radius: 999px;
    border: 1px solid var(--line); background: linear-gradient(to bottom, transparent, rgba(0,0,0,.02));
  }

  .children{
    margin-left: 22px; padding-left: 12px; border-left: 1px dashed var(--line);
    opacity: 0; transform: translateY(-2px);
    transition: opacity .14s ease, transform .14s ease;
  }
  .children.open{ opacity: 1; transform: translateY(0); }

  .hidden{ display: none !important; }

  /* Accessibility */
  .row:focus-within{ outline: var(--ring) solid transparent; box-shadow: 0 0 0 var(--ring) var(--accent-soft); }
  .toggle:focus-visible{ outline: none; box-shadow: 0 0 0 var(--ring) var(--accent-soft); }
  .label:focus-visible{ outline: none; box-shadow: 0 0 0 var(--ring) var(--accent-soft); border-radius: 8px; }

  /* Container card for each tree */
  .shell{ margin-top: 14px; }

  @media (prefers-color-scheme: dark){
    .toggle{ border-color: color-mix(in srgb, var(--btn-border) 80%, var(--text)); }
  }
  @media (prefers-contrast: more){
    .toggle{ box-shadow: 0 0 0 2px var(--accent-soft) inset; }
    .label[target="_blank"]::after{ font-weight: 700; }
  }
  @media (forced-colors: active){
    .toggle{ forced-color-adjust: none; color: ButtonText; border-color: ButtonText; background: Canvas; }
    .label[target="_blank"]::after{ forced-color-adjust: none; color: ButtonText; }
  }
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="toolbar panel" style="padding:12px; gap:12px;">
        <div class="title">Company Dashboards</div>
        <input id="q" type="search" placeholder="Filter (active tab)…" aria-label="Filter dashboards in active department" />
        <button id="expand" type="button" class="btn" title="Expand all in active tab">Expand all</button>
        <button id="collapse" type="button" class="btn" title="Collapse all in active tab">Collapse all</button>
        <span class="count" id="count" aria-live="polite"></span>
      </div>

<nav class="tabs panel" aria-label="Departments">
  <div role="tablist" aria-orientation="horizontal" class="tablist">
    <button class="tab" role="tab" id="tab-SDR" aria-controls="panel-SDR" aria-selected="true">SDR</button>
    <button class="tab" role="tab" id="tab-Events" aria-controls="panel-Events" aria-selected="false">Events</button>
    <button class="tab" role="tab" id="tab-Sales" aria-controls="panel-Sales" aria-selected="false">Sales</button>
    <button class="tab" role="tab" id="tab-Cancelations" aria-controls="panel-Cancelations" aria-selected="false">Cancelations</button>
    <button class="tab" role="tab" id="tab-Partnerships" aria-controls="panel-Partnerships" aria-selected="false">Partnerships</button>
    <button class="tab" role="tab" id="tab-Executive" aria-controls="panel-Executive" aria-selected="false">Executive</button>
    <button class="tab" role="tab" id="tab-Onboarding" aria-controls="panel-Onboarding" aria-selected="false">Onboarding</button>
    <button class="tab" role="tab" id="tab-Support" aria-controls="panel-Support" aria-selected="false">Support</button>
  </div>
</nav>
</header>

<section id="panel-SDR" role="tabpanel" aria-labelledby="tab-SDR" class="tabpanel active">
  <div class="shell panel">
    <ul id="tree-SDR" class="tree" role="tree" aria-label="SDR dashboards"></ul>
  </div>
</section>

<section id="panel-Events" role="tabpanel" aria-labelledby="tab-Events" class="tabpanel">
  <div class="shell panel">
    <ul id="tree-Events" class="tree" role="tree" aria-label="Events dashboards"></ul>
  </div>
</section>

<section id="panel-Sales" role="tabpanel" aria-labelledby="tab-Sales" class="tabpanel">
  <div class="shell panel">
    <ul id="tree-Sales" class="tree" role="tree" aria-label="Sales dashboards"></ul>
  </div>
</section>

<section id="panel-Cancelations" role="tabpanel" aria-labelledby="tab-Cancelations" class="tabpanel">
  <div class="shell panel">
    <ul id="tree-Cancelations" class="tree" role="tree" aria-label="Cancelations dashboards"></ul>
  </div>
</section>

<section id="panel-Partnerships" role="tabpanel" aria-labelledby="tab-Partnerships" class="tabpanel">
  <div class="shell panel">
    <ul id="tree-Partnerships" class="tree" role="tree" aria-label="Partnerships dashboards"></ul>
  </div>
</section>

<section id="panel-Executive" role="tabpanel" aria-labelledby="tab-Executive" class="tabpanel">
  <div class="shell panel">
    <ul id="tree-Executive" class="tree" role="tree" aria-label="Executive dashboards"></ul>
  </div>
</section>

<section id="panel-Onboarding" role="tabpanel" aria-labelledby="tab-Onboarding" class="tabpanel">
  <div class="shell panel">
    <ul id="tree-Onboarding" class="tree" role="tree" aria-label="Onboarding dashboards"></ul>
  </div>
</section>

<section id="panel-Support" role="tabpanel" aria-labelledby="tab-Support" class="tabpanel">
  <div class="shell panel">
    <ul id="tree-Support" class="tree" role="tree" aria-label="Support dashboards"></ul>
  </div>
</section>

</div>
<script>
/*** Structure-only update per your spec ***/
const DATA = {
  SDR: [
    {
      id: "sdr-kpi",
      title: "SDR KPI",
      children: [
        { id: "sdr-kpi-overview", title: "Overview", url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137307652?appliedIlsFilters=JTdCJTIyMTM3MzA3NjUyJTIyJTNBJTdCJTIyMC0zJTIyJTNBJTdCJTIyZmlsdGVycyUyMiUzQSU1QiU3QiUyMnByb3BlcnR5TmFtZSUyMiUzQSUyMnNldHRlciUyMiUyQyUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZSUyMiUzQSU3QiUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZXMlMjIlM0ElNUIlMjI4MTEzNjg2MyUyMiU1RCU3RCU3RCU1RCUyQyUyMmRhdGFTb3VyY2VOYW1lJTIyJTNBJTIyREVBTCUyMiU3RCU3RCU3RA%3D%3D" },
        { id: "sdr-kpi-ky",       title: "Ky",       url: "#" },
        { id: "sdr-kpi-stan",     title: "Stan",     url: "#" },
        { id: "sdr-kpi-jaredw",   title: "Jared W",  url: "#" }
      ]
    },
    {
      id: "sdr",
      title: "SDR",
      children: [
        { id: "sdr-yearly",  title: "Yearly",  url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/136882917" },
        { id: "sdr-monthly", title: "Monthly", url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/136888045" },
        { id: "sdr-daily",   title: "Daily",   url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/136880234" }
      ]
    }
  ],

  Events: [
    {
      id: "events-october",
      title: "October",
      children: [
        { id: "events-october-overview",              title: "October",                         url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137281602?appliedIlsFilters=JTdCJTIyMTM3MjgxNjAyJTIyJTNBJTdCJTIyMC0zJTIyJTNBJTdCJTIyZmlsdGVycyUyMiUzQSU1QiU3QiUyMnByb3BlcnR5TmFtZSUyMiUzQSUyMnN1Yl9sZWFkX3NvdXJjZSUyMiUyQyUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZSUyMiUzQSU3QiUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZXMlMjIlM0ElNUIlMjIyMDI1JTIwLSUyMFRoZSUyMFdlYWx0aHklMjBQbHVtYmVyJTIwSG9vcmFoJTIyJTJDJTIyMjAyNSUyMC0lMjBTeXN0ZW0lMjBGb3J3YXJkJTIyJTJDJTIyMjAyNSUyMC0lMjBMZW5ub3glMjBMaXZlJTIwUm9hZHNob3clMjIlMkMlMjIyMDI1JTIwLSUyMEdhcmFnZSUyMERvb3IlMjBGcmVlZG9tJTIwVmVydGljYWwlMjBUcmFjayUyMiUyQyUyMjIwMjUlMjAtJTIwTGVnYWN5JTIwQW5udWFsJTIwT2Zmc2l0ZSUyMiUyQyUyMjIwMjUlMjAtJTIwSG9tZSUyMGFuZCUyMENvbW1lcmNpYWwlMjBTZXJ2aWNlcyUyME1hcmtldGluZyUyMFN1bW1pdCUyMiUyQyUyMjIwMjUlMjAtJTIwTnV2ZSUyME5ldHdvcmtzJTIwVG91ciUyMiUyQyUyMjIwMjUlMjAtJTIwQ2xvdmVyJTIwTWFzdGVybWluZCUyMiUyQyUyMjIwMjUlMjAtJTIwWm9vbSUyMERyYWluJTIwRXhwbyUyMiUyQyUyMjIwMjUlMjAtJTIwU2VydmljZSUyMFdvcmxkJTIyJTJDJTIyMjAyNSUyMC0lMjBOZXR3b3JrJTIwU1QlMjBFdmVudCUyMiU1RCU3RCU3RCU1RCUyQyUyMmRhdGFTb3VyY2VOYW1lJTIyJTNBJTIyREVBTCUyMiU3RCU3RCU3RA%3D%3D" },
        { id: "events-wealthy-plumber-hoorah",        title: "Wealthy Plumber HOORAH",          url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137143993" },
        { id: "events-system-forward-pro-bootcamp",   title: "System Forward Pro Boot Camp",    url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137261328?appliedIlsFilters=JTdCJTIyMTM3MjYxMzI4JTIyJTNBJTdCJTIyMC0zJTIyJTNBJTdCJTIyZmlsdGVycyUyMiUzQSU1QiU3QiUyMnByb3BlcnR5TmFtZSUyMiUzQSUyMnN1Yl9sZWFkX3NvdXJjZSUyMiUyQyUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZSUyMiUzQSU3QiUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZXMlMjIlM0ElNUIlMjIyMDI1JTIwLSUyMFN5c3RlbSUyMEZvcndhcmQlMjIlNUQlN0QlN0QlNUQlMkMlMjJkYXRhU291cmNlTmFtZSUyMiUzQSUyMkRFQUwlMjIlN0QlN0QlN0Q%3D" },
        { id: "events-lennox-live-roadshow",          title: "Lennox Live Roadshow",            url: "#" },
        { id: "events-gdf-vertical-track",            title: "GDF Vertical Track",              url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137261375?appliedIlsFilters=JTdCJTIyMTM3MjYxMzc1JTIyJTNBJTdCJTIyMC0zJTIyJTNBJTdCJTIyZmlsdGVycyUyMiUzQSU1QiU3QiUyMnByb3BlcnR5TmFtZSUyMiUzQSUyMnN1Yl9sZWFkX3NvdXJjZSUyMiUyQyUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZSUyMiUzQSU3QiUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZXMlMjIlM0ElNUIlMjIyMDI1JTIwLSUyMEdhcmFnZSUyMERvb3IlMjBGcmVlZG9tJTIwVmVydGljYWwlMjBUcmFjayUyMiU1RCU3RCU3RCU1RCUyQyUyMmRhdGFTb3VyY2VOYW1lJTIyJTNBJTIyREVBTCUyMiU3RCU3RCU3RA%3D%3D" },
        { id: "events-legacy-annual-offsite",         title: "Legacy Annual Offsite",           url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137261436?appliedIlsFilters=JTdCJTIyMTM3MjYxNDM2JTIyJTNBJTdCJTIyMC0zJTIyJTNBJTdCJTIyZmlsdGVycyUyMiUzQSU1QiU3QiUyMnByb3BlcnR5TmFtZSUyMiUzQSUyMnN1Yl9sZWFkX3NvdXJjZSUyMiUyQyUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZSUyMiUzQSU3QiUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZXMlMjIlM0ElNUIlMjIyMDI1JTIwLSUyMExlZ2FjeSUyMEFubnVhbCUyME9mZnNpdGUlMjIlNUQlN0QlN0QlNUQlMkMlMjJkYXRhU291cmNlTmFtZSUyMiUzQSUyMkRFQUwlMjIlN0QlN0QlN0Q%3D" },
        { id: "events-nuve-networks-tour",            title: "Nuve Networks Tour",              url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137261580?appliedIlsFilters=JTdCJTIyMTM3MjYxNTgwJTIyJTNBJTdCJTIyMC0zJTIyJTNBJTdCJTIyZmlsdGVycyUyMiUzQSU1QiU3QiUyMnByb3BlcnR5TmFtZSUyMiUzQSUyMnN1Yl9sZWFkX3NvdXJjZSUyMiUyQyUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZSUyMiUzQSU3QiUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZXMlMjIlM0ElNUIlMjIyMDI1JTIwLSUyME51dmUlMjBOZXR3b3JrcyUyMFRvdXIlMjIlNUQlN0QlN0QlNUQlMkMlMjJkYXRhU291cmNlTmFtZSUyMiUzQSUyMkRFQUwlMjIlN0QlN0QlN0Q%3D" },
        { id: "events-clover-mastermind",             title: "Clover Mastermind",               url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137261616?appliedIlsFilters=JTdCJTIyMTM3MjYxNjE2JTIyJTNBJTdCJTIyMC0zJTIyJTNBJTdCJTIyZmlsdGVycyUyMiUzQSU1QiU3QiUyMnByb3BlcnR5TmFtZSUyMiUzQSUyMnN1Yl9sZWFkX3NvdXJjZSUyMiUyQyUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZSUyMiUzQSU3QiUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZXMlMjIlM0ElNUIlMjIyMDI1JTIwLSUyMENsb3ZlciUyME1hc3Rlcm1pbmQlMjIlNUQlN0QlN0QlNUQlMkMlMjJkYXRhU291cmNlTmFtZSUyMiUzQSUyMkRFQUwlMjIlN0QlN0QlN0Q%3D" },
        { id: "events-zoom-drain-expo",               title: "Zoom Drain Expo",                 url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137261632?appliedIlsFilters=JTdCJTIyMTM3MjYxNjMyJTIyJTNBJTdCJTIyMC0zJTIyJTNBJTdCJTIyZmlsdGVycyUyMiUzQSU1QiU3QiUyMnByb3BlcnR5TmFtZSUyMiUzQSUyMnN1Yl9sZWFkX3NvdXJjZSUyMiUyQyUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZSUyMiUzQSU3QiUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZXMlMjIlM0ElNUIlMjIyMDI1JTIwLSUyMFpvb20lMjBEcmFpbiUyMEV4cG8lMjIlNUQlN0QlN0QlNUQlMkMlMjJkYXRhU291cmNlTmFtZSUyMiUzQSUyMkRFQUwlMjIlN0QlN0QlN0Q%3D" },
        { id: "events-service-world",                 title: "Service World",                   url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137281465?appliedIlsFilters=JTdCJTIyMTM3MjgxNDY1JTIyJTNBJTdCJTIyMC0zJTIyJTNBJTdCJTIyZmlsdGVycyUyMiUzQSU1QiU3QiUyMnByb3BlcnR5TmFtZSUyMiUzQSUyMnN1Yl9sZWFkX3NvdXJjZSUyMiUyQyUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZSUyMiUzQSU3QiUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZXMlMjIlM0ElNUIlMjIyMDI1JTIwLSUyMFNlcnZpY2UlMjBXb3JsZCUyMiU1RCU3RCU3RCU1RCUyQyUyMmRhdGFTb3VyY2VOYW1lJTIyJTNBJTIyREVBTCUyMiU3RCU3RCU3RA%3D%3D" },
        { id: "events-network-st-event",              title: "Network ST event",                url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137281522?appliedIlsFilters=JTdCJTIyMTM3MjgxNTIyJTIyJTNBJTdCJTIyMC0zJTIyJTNBJTdCJTIyZmlsdGVycyUyMiUzQSU1QiU3QiUyMnByb3BlcnR5TmFtZSUyMiUzQSUyMnN1Yl9sZWFkX3NvdXJjZSUyMiUyQyUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZSUyMiUzQSU3QiUyMnByb3BlcnR5VHlwZSUyMiUzQSUyMmVudW1lcmF0aW9uJTIyJTJDJTIyb3BlcmF0b3IlMjIlM0ElMjJJU19BTllfT0YlMjIlMkMlMjJ2YWx1ZXMlMjIlM0ElNUIlMjIyMDI1JTIwLSUyME5ldHdvcmslMjBTVCUyMEV2ZW50JTIyJTVEJTdEJTdEJTVEJTJDJTIyZGF0YVNvdXJjZU5hbWUlMjIlM0ElMjJERUFMJTIyJTdEJTdEJTdE" }
      ]
    },
    {
      id: "events-september",
      title: "September",
      children: [
        { id: "events-september-overview",            title: "September",                       url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137085472" },
        { id: "events-home-service-freedom",          title: "Home Service Freedom",            url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137043392" },
        { id: "events-pantheon",                      title: "Pantheon",                        url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137054779" },
        { id: "events-certain-path-fall-expo",        title: "Certain Path Fall Expo \"Partner Jam\"", url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137242704" },
        { id: "events-nexstar-super-meeting",         title: "Nexstar Super Meeting",           url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137094368" }
      ]
    }
  ],

  Sales: [
    {
      id: "sales-overview",
      title: "Overview",
      children: [
        { id: "sales-overview-yearly",  title: "Yearly",  url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/136888663" },
        { id: "sales-overview-monthly", title: "Monthly", url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/136888524" },
        { id: "sales-overview-weekly",  title: "Weekly",  url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/136888359" }
      ]
    },
    {
      id: "sales-kpis",
      title: "KPI's",
      children: [
        { id: "sales-kpis-overview", title: "Overview", url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137292152" },
        { id: "sales-kpis-parker",   title: "Parker",   url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137292072" },
        { id: "sales-kpis-colton",   title: "Colton",   url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137292007" },
        { id: "sales-kpis-korth",    title: "Korth",    url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137282114" },
        { id: "sales-kpis-ky",       title: "Ky",       url: "#" }
      ]
    }
  ],

  Cancelations: [
    {
      id: "cancelations-overview",
      title: "Overview",
      url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/16011189"
    }
  ],

  Partnerships: [
    {
      id: "partnerships-team",
      title: "team",
      url: "#"
    }
  ],

  Executive: [
    { id: "executive-overview", title: "Overview", url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/136821485" },
    { id: "executive-monthly",  title: "Monthly",  url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/136909151" },
    { id: "executive-weekly",   title: "Weekly",   url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/136909113" }
  ],

  Onboarding: [
    {
      id: "onboarding-ticket-pipeline",
      title: "Ticket Pipeline",
      children: [
        { id: "onboarding-ticket-yearly",  title: "Yearly",  url: "#" },
        { id: "onboarding-ticket-monthly", title: "Monthly", url: "#" },
        { id: "onboarding-ticket-weekly",  title: "Weekly",  url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/137093722" }
      ]
    }
  ],

  Support: [
    { id: "support-overview", title: "Overview", url: "https://app-na2.hubspot.com/reports-dashboard/23947290/view/136874106" }
  ]
};

/*** Core tree rendering (unchanged) ***/
function isLeaf(node){ return !node.children || node.children.length === 0; }
function leafCount(node){ if (isLeaf(node)) return 1; return (node.children||[]).reduce((s,c)=>s+leafCount(c),0); }
function flatten(nodes, arr = []){ for (const n of nodes){ arr.push(n); if (n.children) flatten(n.children, arr); } return arr; }

/*** Per-tab state ***/
const qEl = document.getElementById("q");
const countEl = document.getElementById("count");
const tabs = Array.from(document.querySelectorAll('[role="tab"]'));
const panels = Array.from(document.querySelectorAll('[role="tabpanel"]'));
const OPEN_KEY_PREFIX = "dept_tree_open_ids_v1_"; // suffixed per tab
let activeTab = "SDR";
let openSets = {}; // tabId -> Set of open node ids
let treeEls = {};  // tabId -> UL element
let dataByTab = DATA;

// map tree ULs
treeEls["SDR"] = document.getElementById("tree-SDR");
treeEls["Events"] = document.getElementById("tree-Events");
treeEls["Sales"] = document.getElementById("tree-Sales");
treeEls["Cancelations"] = document.getElementById("tree-Cancelations");
treeEls["Partnerships"] = document.getElementById("tree-Partnerships");
treeEls["Executive"] = document.getElementById("tree-Executive");
treeEls["Onboarding"] = document.getElementById("tree-Onboarding");
treeEls["Support"] = document.getElementById("tree-Support");

function loadOpen(tab){
  if (!openSets[tab]) {
    const raw = localStorage.getItem(OPEN_KEY_PREFIX + tab) || "[]";
    openSets[tab] = new Set(JSON.parse(raw));
  }
  return openSets[tab];
}
function saveOpen(tab){
  localStorage.setItem(OPEN_KEY_PREFIX + tab, JSON.stringify([...openSets[tab]]));
}

function render(nodes, parentEl, tab){
  parentEl.innerHTML = "";
  let totalLeaves = 0;
  const openSet = loadOpen(tab);

  for (const node of nodes) {
    const li = document.createElement("li");
    li.className = "node";
    li.dataset.id = node.id;
    li.setAttribute("role", "treeitem");
    li.setAttribute("aria-expanded", openSet.has(node.id));

    const row = document.createElement("div");
    row.className = "row";

    const tog = document.createElement("button");
    tog.className = "toggle" + (isLeaf(node) ? " leaf" : "");
    tog.type = "button";
    tog.setAttribute("aria-label", isLeaf(node) ? "leaf" : "toggle");
    tog.textContent = openSet.has(node.id) ? "▾" : "▸";
    tog.addEventListener("click", () => toggleNode(node.id, li, tab));
    row.appendChild(tog);

    const label = document.createElement(node.url ? "a" : "span");
    if (node.url) { label.href = node.url; label.target = "_blank"; label.rel = "noopener noreferrer"; }
    label.className = "label";
    label.textContent = node.title || node.id;
    row.appendChild(label);

    if (!isLeaf(node)) {
      const b = document.createElement("span");
      b.className = "badge";
      b.textContent = leafCount(node);
      b.setAttribute("aria-label", "Total dashboards in this branch");
      row.appendChild(b);
    }

    li.appendChild(row);
    parentEl.appendChild(li);

    if (!isLeaf(node)) {
      const children = document.createElement("ul");
      const isOpen = openSet.has(node.id);
      children.className = "children" + (isOpen ? " open" : " hidden");
      children.setAttribute("role", "group");
      li.appendChild(children);
      totalLeaves += render(node.children, children, tab);
    } else {
      totalLeaves += 1;
    }
  }
  return totalLeaves;
}

function toggleNode(id, liEl, tab){
  const children = liEl.querySelector(":scope > .children");
  if (!children) return;
  const openSet = loadOpen(tab);
  const isOpen = openSet.has(id);
  const btn = liEl.querySelector(":scope > .row .toggle");
  if (isOpen) openSet.delete(id); else openSet.add(id);
  saveOpen(tab);
  btn.textContent = isOpen ? "▸" : "▾";
  liEl.setAttribute("aria-expanded", !isOpen);
  if (isOpen){ children.classList.remove("open"); children.classList.add("hidden"); }
  else { children.classList.remove("hidden"); void children.offsetWidth; children.classList.add("open"); }
}

function filterActiveTree(query){
  const treeEl = treeEls[activeTab];
  const data = dataByTab[activeTab];
  const openSet = loadOpen(activeTab);

  function fullReset(){
    treeEl.querySelectorAll(".row").forEach(r => r.classList.remove("hit"));
    treeEl.querySelectorAll(".node").forEach(n => n.classList.remove("hidden"));
    treeEl.querySelectorAll(".node").forEach(n => {
      const id = n.dataset.id;
      const children = n.querySelector(":scope > .children");
      const tog = n.querySelector(":scope > .row .toggle");
      if (children && tog) {
        const open = openSet.has(id);
        children.classList.toggle("hidden", !open);
        children.classList.toggle("open", open);
        tog.textContent = open ? "▾" : "▸";
        n.setAttribute("aria-expanded", open);
      }
    });
  }

  query = (query || "").trim().toLowerCase();
  if (!query){ fullReset(); return; }

  treeEl.querySelectorAll(".row").forEach(r => r.classList.remove("hit"));
  const all = flatten(data);
  const hits = new Set(all.filter(n => (n.title || n.id).toLowerCase().includes(query)).map(n => n.id));

  function markVisibility(node){
    const selfHit = hits.has(node.id);
    let childVisible = false;
    (node.children||[]).forEach(ch => { if (markVisibility(ch)) childVisible = true; });
    const visible = selfHit || childVisible;

    const el = treeEl.querySelector(`.node[data-id="${CSS.escape(node.id)}"]`);
    if (el){
      el.classList.toggle("hidden", !visible);
      const row = el.querySelector(":scope > .row");
      if (visible && row) row.classList.add("hit");
      const children = el.querySelector(":scope > .children");
      const tog = el.querySelector(":scope > .row .toggle");
      if (children && tog){
        children.classList.toggle("hidden", !childVisible);
        children.classList.toggle("open", childVisible);
        tog.textContent = childVisible ? "▾" : "▸";
        el.setAttribute("aria-expanded", childVisible);
      }
    }
    return visible;
  }
  data.forEach(root => markVisibility(root));
}

function renderActive(){
  const treeEl = treeEls[activeTab];
  const data = dataByTab[activeTab];
  const leaves = render(data, treeEl, activeTab);
  document.getElementById("count").textContent = `${activeTab} dashboards: ${leaves}`;
}

function switchTab(toId){
  if (toId === activeTab) return;
  // update tabs/panels aria + classes
  tabs.forEach(t => t.setAttribute("aria-selected", String(t.id === "tab-" + toId)));
  panels.forEach(p => p.classList.toggle("active", p.id === "panel-" + toId));
  activeTab = toId;
  renderActive();
  filterActiveTree(qEl.value);
  // reflect in URL (non-destructive)
  const url = new URL(location.href);
  url.searchParams.set("tab", activeTab);
  history.replaceState({}, "", url);
}

// Init: render all once for faster tab switching
Object.keys(treeEls).forEach(tabId => {
  render(dataByTab[tabId], treeEls[tabId], tabId);
});
renderActive();

// Controls apply to active tab
document.getElementById("expand").addEventListener("click", () => {
  const all = flatten(dataByTab[activeTab]);
  openSets[activeTab] = new Set(all.filter(n => !isLeaf(n)).map(n => n.id));
  saveOpen(activeTab);
  filterActiveTree(qEl.value); // will open everything respecting filter
});

document.getElementById("collapse").addEventListener("click", () => {
  openSets[activeTab] = new Set();
  saveOpen(activeTab);
  filterActiveTree(qEl.value); // will close everything
});

qEl.addEventListener("input", () => filterActiveTree(qEl.value));

// Tab click
tabs.forEach(btn => {
  btn.addEventListener("click", () => switchTab(btn.id.replace("tab-","")));
});

// Deep links: ?tab=SDR&q=foo
const params = new URLSearchParams(location.search);
const initialTab = params.get("tab");
if (initialTab && treeEls[initialTab]) {
  // flip ARIA/UI then render/filter
  tabs.forEach(t => t.setAttribute("aria-selected", "false"));
  document.getElementById("tab-" + initialTab)?.setAttribute("aria-selected","true");
  panels.forEach(p => p.classList.remove("active"));
  document.getElementById("panel-" + initialTab)?.classList.add("active");
  activeTab = initialTab;
}
if (params.get("q")) qEl.value = params.get("q");
renderActive();
filterActiveTree(qEl.value || "");
</script>
</body>
</html>
